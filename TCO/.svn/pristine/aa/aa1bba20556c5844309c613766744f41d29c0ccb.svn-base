<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<script src="/resources/js/jquery-3.6.0.min.js"></script>
<script src='/resources/js/fullcalendar/main.min.js'></script>
<script src='/resources/js/maincalendar.js'></script>
<script src='/resources/js/commoncalendar.js'></script>
<link href='/resources/js/fullcalendar/main.min.css' rel='stylesheet' />
<script type="text/javascript">
var newArray 	= [];
<c:forEach var="vo" items="${strg}">
	var jsonObj = new Object();
	jsonObj.cmncdNm1 = "${vo.cmncdNm1}";
	jsonObj.cmncdNm2 = "${vo.cmncdNm2}";
	jsonObj.prodInfoNm = "${vo.prodInfoNmDisplay}";
	jsonObj.strgStckOrdrYn = "${vo.strgStckOrdrYn}";
	jsonObj.lackQty = "${vo.strgStckQty - vo.strgStckSftyQty}";
	
	jsonObj = JSON.stringify(jsonObj);
	console.log("JSON jsonObj : " + jsonObj);
	//String í˜•íƒœë¡œ íŒŒì‹±í•œ ê°ì²´ë¥¼ ë‹¤ì‹œ jsonìœ¼ë¡œ ë³€í™˜
	newArray.push(JSON.parse(jsonObj));
</c:forEach>
var jsonArray = newArray;
//í…Œì´ë¸”ì— ì¶”ê°€í•  ë‚´ìš© ë§Œë“œëŠ” í•¨ìˆ˜
var str = "";
function chgFilter(){
	jsonArray = jsonArray.reduce((pre, cur) => {
		if( cur.strgStckOrdrYn == 'N' ) pre.push(cur);
		return pre;
	}, []);
	str = "";
	console.log("chgFilter ì•ˆ jsonArray.length : " + jsonArray.length);
	for(var i=0; i < jsonArray.length; i++){
		if(i <= 3){
			str += '<tr class="arryTd"><td data-org-colspan="1" data-priority="1" data-columns="tech-companies-1-col-1">';
			str += jsonArray[i].cmncdNm1 + "/" + jsonArray[i].cmncdNm2 + "</td>";
			str += '<td data-org-colspan="1" data-priority="3" data-columns="tech-companies-1-col-2">';
			str += jsonArray[i].prodInfoNm + "</td>";
			str += '<td data-org-colspan="1" data-priority="1" data-columns="tech-companies-1-col-3" style="text-align:right;">';
			str += jsonArray[i].lackQty + "</td></tr>";
		}
	}
	$("#tbContent").append(str);
}
	$(function(){
		chgFilter();
		$.ajax({
			url:"/sttst/BrnChart",
			async:true,
			type: "POST",
			dataType:"json",
			contentType: "application/json; charset=utf-8",
			success:function(data){
				var salelist=[];
				var datelist=[];
				
				$.each(data,function(){
					salelist.push(this["sale"])
					datelist.push(this["date"])
				})
				
				console.log(salelist);
				console.log(datelist);
				const ctx = document.getElementById('myChart').getContext('2d');
				// ê·¸ë˜í”½ ì—”ì§„ìœ¼ë¡œ ìœ ëª…í•œ ê²ƒ (DirectX, OpenGL)
				const myChart = new Chart(ctx, {
				    type: 'bar', //bar,line,pie,doughnut,radar
				    //labels : xì¶•ì˜ ê°’
				    //datasets : yì¶•ì˜ ê°’ dataì˜ ê°’, ì†ì„±ë“¤ ì§€ì •
				    data: {
				        labels: datelist,
				        datasets: [{
				            label: 'ë§¤ì¥ì¼ì¼ë§¤ì¶œ',
				            data: salelist,
				            backgroundColor: [
				                '#556EE6'
				            ],
				            borderColor: [
				            	'white'
				            ],
				            borderWidth: 3
				        }]
				    },
				    options: {
				        scales: {
				            y: {
				                beginAtZero: true
				            }
				        }
				    }
				});
			}
		});			
	})
</script>
<style>
/* ê³µí†µë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
.ì¤‘ìš” {
	background-color: #F5A9BC;
	border-color: #F5A9BC;
}
.ë³´í†µ {
	background-color: #F7D358;
	border-color: #F7D358;
}
.ë‚®ìŒ {
	background-color: #2E9AFE;
	border-color: #2E9AFE;
}


/* ë‹¬ë ¥ë‚´ë¶€ì˜ ì´ë²¤íŠ¸  */

.fc-event-time {
	display: none;
}
.fc-event{
	cursor:pointer;
}

/* ì „ì‚¬ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */

.ë¹¨ê°• {
	background-color: #FE2E2E;
	color: white;
}
</style>


<div class="row">
	<div class="col-12">
		<div
			class="page-title-box d-sm-flex align-items-center justify-content-between">

			<h1 class="mb-sm-0 font-size-20" id="timesm">TCOğŸ’«</h1>

		</div>
	</div>
</div>
<!-- end page title -->

<div class="row">
	<div class="col-lg-12">
		<div class="card">
			<div class="card-body">
				<div class="row">
					<div class="col-lg-4">
						<div class="d-flex">
							<div class="flex-shrink-0 me-3">ì´ë¯¸ì§€</div>
							<div class="flex-grow-1 align-self-center">
								<div class="text-muted">
									<p class="mb-2" id="times"></p>
									<h5 class="mb-1">ì´ë¦„&nbsp;ë³¸ì‚¬</h5>
									<p class="mb-0">ë¶€ì„œ / ì§ê¸‰</p>
								</div>
							</div>
						</div>
					</div>

					<div class="col-lg-4 align-self-center">
						<div class="text-lg-center mt-4 mt-lg-0">
							<div class="row">
								<div class="col-4">
									<div>
										<p class="text-muted text-truncate mb-2">ã…Œ</p>
										<h5 class="mb-0">ì¶œê·¼ë²„íŠ¼</h5>
									</div>
								</div>
								<div class="col-4">
									<div>
										<p class="text-muted text-truncate mb-2">ã…Œ</p>
										<h5 class="mb-0">í‡´ê·¼ë²„íŠ¼</h5>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="col-lg-4 d-none d-lg-block">
						<div class="clearfix mt-4 mt-lg-0"></div>
					</div>
				</div>
				<!-- end row -->
			</div>
		</div>
	</div>
</div>
<!-- end row -->


<div class="col-xl-18">
	<div class="row">
		<div class="col-sm-4">
			<div class="card">
				<div class="card-body">
					<div class="col">
						<div class="row-6">
							<div class="d-flex align-items-center mb-5">
								<div class="avatar-xs me-3">
									<span
										class="avatar-title rounded-circle bg-primary bg-soft text-primary font-size-18">
										<i class="bx bx-briefcase-alt"></i>
									</span>
								</div>
								<h5 class="font-size-16 mb-0">ë§¤ì¶œ</h5>
								<a
									class="btn btn-primary btn-sm waves-effect waves-light float-right"
									href="/sls/brnlist" style="margin-left: 350px;"><i
									class="bx bx-plus-medical"></i></a>
							</div>
						</div>
						<div class="row-6">
							<div class="linechart" style="height: 100%; width: 100%;">
								<canvas id="myChart"></canvas>
							</div>
						</div>
					</div>
					<br>

				</div>
			</div>
		</div>

		<div class="col-sm-4">
			<div class="card">
				<div class="card-body">
					<div class="d-flex align-items-center mb-5">
						<div class="avatar-xs me-3">
							<span
								class="avatar-title rounded-circle bg-primary bg-soft text-primary font-size-18">
								<i class="bx bx-briefcase-alt"></i>
							</span>
						</div>
						<h6 class="font-size-12 mb-0">ë¶€ì¡±ì¬ê³ </h6>
						<c:if test="${sessionScope.brncofcId == 'BRN00000' }">
							<a
								class="btn btn-primary btn-sm waves-effect waves-light float-right"
								href="/strgstck/headLack" style="margin-left: 350px;"><i
								class="bx bx-plus-medical"></i></a>
						</c:if>
						<c:if test="${sessionScope.brncofcId != 'BRN00000' }">
							<a
								class="btn btn-primary btn-sm waves-effect waves-light float-right"
								href="/store/lackStock?brncofcId=${sessionScope.brncofcId}"
								style="margin-left: 350px;"><i class="bx bx-plus-medical"></i></a>
						</c:if>

					</div>
					<table class="table align-middle table-nowrap table-check">
						<thead class="table-light">
							<tr>
								<th class="align-middle">ë¶„ë¥˜</th>
								<th class="align-middle">ìƒí’ˆëª…</th>
								<th class="align-middle">ë¶€ì¡±ì¬ê³  ìˆ˜</th>
							</tr>
						</thead>
						<tbody id="tbContent">
						</tbody>
					</table>
					<br>

				</div>
			</div>
		</div>
		<div class="col-sm-4">
			<div class="card">
				<div class="card-body">
					<div class="d-flex align-items-center mb-5">
						<div class="avatar-xs me-3">
							<span
								class="avatar-title rounded-circle bg-primary bg-soft text-primary font-size-18">
								<i class="bx bx-briefcase-alt"></i>
							</span>
						</div>
						<h5 class="font-size-16 mb-0">ìˆ˜ì£¼</h5>
						<a
							class="btn btn-primary btn-sm waves-effect waves-light float-right"
							href="/strgstck/rcvordr" style="margin-left: 350px;"><i
							class="bx bx-plus-medical"></i></a>
					</div>

					<table class="table align-middle table-nowrap table-check">
						<thead class="table-light">
							<tr>
								<th class="align-middle">ë°œì£¼ë²ˆí˜¸</th>
								<th class="align-middle">ë°œì£¼ì§€ì </th>
								<th class="align-middle">ë°œì£¼ì¼</th>
								<th class="align-middle">ìƒì„¸ë³´ê¸°</th>
							</tr>
						</thead>
						<tbody>
							<c:set var="i" value="0" />
							<c:forEach var="y" items="${ordr}">
								<c:set var="cnt" value="${i=i+1}" />
								<c:if test="${cnt <= 4 }">
									<tr>
										<td>${y.ordrId}</td>
										<td>${y.brncofcNm}</td>
										<td><fmt:formatDate pattern="yyyy-MM-dd"
												value="${y.ordrDt}" /></td>
										<td>
											<!-- Button trigger modal --> <a
											href="/strgstck/ordrDetail?ordrId=${y.ordrId}"
											class="btn btn-primary btn-sm btn-rounded">ìƒì„¸ë³´ê¸°</a>
										</td>
									</tr>
								</c:if>
							</c:forEach>
						</tbody>
					</table>
					<br>
				</div>
			</div>
		</div>


	</div>
	<!-- end row -->
</div>


<div class="row">
	<!-- ìº˜ë¦°ë” -->
	<div class="col-lg-6">
		<div class="card">
			<div class="card-body">
				<div>
					<ul class="nav nav-tabs nav-tabs-custom justify-content-center pt-2">
					    <li class="nav-item"><a class="nav-link active" href="#main" data-bs-toggle="tab" role="tab">ì „ì‚¬ìº˜ë¦°ë”</a></li>
					    <li class="nav-item"><a class="nav-link" href="#common" data-bs-toggle="tab" role="tab">MYìº˜ë¦°ë”</a></li>
					</ul> 
				</div>
				<div class="tab-content p-4">
				
				<!-- tab -->
				<div class="tab-pane active" id="main" role="tabpanel">
					<div class="col">
						<div class="row-6">
							<div class="d-flex align-items-center mb-5">
								<div class="avatar-xs me-3">
									<span
										class="avatar-title rounded-circle bg-primary bg-soft text-primary font-size-18">
										<i class="bx bx-time-five"></i>
									</span>
								</div>
								<p>ì „ì‚¬ìº˜ë¦°ë”</p>
									<c:if test="${sessionScope.brncofcId == 'BRN00000' }">
									<a
									class="btn btn-primary btn-sm waves-effect waves-light float-right"
									href="/calendar/main" style="margin-left: 600px;"><i
									class="bx bx-plus-medical"></i></a>
									</c:if>
							</div>
						</div>
						<div class="row-6">
							<div id="maincalendar"></div>
						</div>
					</div>
				</div>
				
				<div class="tab-pane" id="common" role="tabpanel">
					<div class="col">
						<div class="row-6">
							<div class="d-flex align-items-center mb-5">
								<div class="avatar-xs me-3">
									<span
										class="avatar-title rounded-circle bg-primary bg-soft text-primary font-size-18">
										<i class="bx bx-time-five"></i>
									</span>
								</div>
								<h5 class="font-size-14 mb-0">MYìº˜ë¦°ë”</h5>
								<a
									class="btn btn-primary btn-sm waves-effect waves-light float-right"
									href="/calendar/main" style="margin-left: 600px;"><i
									class="bx bx-plus-medical"></i></a>
							</div>
						</div>
						<div class="row-6">
							<div id="calendar"></div>
						</div>
					</div>
				</div>
				<!-- end tab -->
				</div>
			</div>
		</div>
	</div>
	<!-- ìº˜ë¦°ë” ë-->
	<div class="col-lg-6">
		<div class="card">
			<div class="card-body">
				<h2>ê¸°ëŠ¥ì¶”ê°€í•„ìš”í•¨</h2>
			</div>
		</div>
	</div>
</div>


<!-- ìº˜ë¦°ë” ìƒì„¸ì •ë³´ ë³´ëŠ” modal -->
<div class="modal fade" id="updatemodal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header py-3 px-4 border-bottom-0">
				<h5 class="modal-title" id="modal-title"><b>ì¼ì •ìƒì„¸ì •ë³´</b></h5>

				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-hidden="true" onclick="fn_close()"></button>
			</div>
			<div class="modal-body p-4">
					<div class="row">
						<!-- ìº˜ë¦°ë”ë²ˆí˜¸(ê³ ìœ í‚¤) -->
						<input type="text" id="calendarNo" name="calendarNo"
							style="display: none;">
						<!-- ë -->
						<div class="col-12">
							<div class="mb-3">
								<label class="form-label">ì‹œì‘ì¼</label> <input
									class="form-control update" type="date" name="startday"
									id="upstartday" />
							</div>
							<div class="mb-3">
								<label class="form-label">ì¢…ë£Œì¼</label> <input
									class="form-control update" type="date" name="endday"
									id="upendday" />
							</div>
						</div>
						<div class="col-12">
							<div class="mb-3">
								<label class="form-label">ì¼ì •ëª…</label> <input
									class="form-control update" placeholder="ì¼ì •ëª…ì„ ë‚¨ê²¨ì£¼ì„¸ìš”"
									type="text" name="title" id="uptitle" />
								<div class="invalid-feedback">Please provide a valid event
									name</div>
							</div>
						</div>
						<div class="col-12">
							<div class="mb-3">
								<label class="form-label">ìƒì„¸ë‚´ìš©</label> <input
									class="form-control update" type="text" name="content"
									id="upcontent" />
								<div class="invalid-feedback">Please provide a valid event
									name</div>
							</div>
						</div>
						<div class="col-12">
							<div class="mb-3">
								<label class="form-label">ì¤‘ìš”ë„</label> <select
									class="form-control form-select update" name="category"
									id="upcategory">
									<option value="ì¤‘ìš”">ì¤‘ìš”</option>
									<option value="ë³´í†µ">ë³´í†µ</option>
									<option value="ë‚®ìŒ">ë‚®ìŒ</option>
								</select>
								<div class="invalid-feedback">Please select a valid event
									category</div>
							</div>
						</div>
					</div>
			</div>
		</div>
		<!-- end modal-content-->
	</div>
	<!-- end modal dialog-->
</div>
<!-- ìº˜ë¦°ë” ìƒì„¸ì •ë³´ ë³´ëŠ” modal ë -->