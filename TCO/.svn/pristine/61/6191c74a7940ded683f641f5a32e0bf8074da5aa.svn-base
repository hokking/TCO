<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%>
<script type="text/javascript" src="/resources/js/jquery-3.6.0.js"></script>
<html>
<head>
<meta charset="utf-8">
<title>:: jsQR í…ŒìŠ¤íŠ¸ ::</title>
<script type="text/javascript" src="/resources/js/jsQR.js"></script>
<style type="text/css">
main {
	width: 100%;
	height: 100%;
	text-align: center;
}

main>div {
	float: left;
	width: 1%;
	height: 98%;
}

main>div:first-child {
	width: 49%;
}

main>div:last-child {
	background-color: #D3D3D3;
	width: 49%;
}

div#output {
	background-color: #BDBEBD;
	padding-left: 10px;
	padding-right: 10px;
	padding-top: 10px;
	padding-bottom: 10px;
}

div#frame {
	border: 2px solid #005666;
	background-color: #FFFFFF;
	margin-left: 10px;
	margin-right: 10px;
	padding-left: 8px;
	padding-right: 8px;
	padding-top: 8px;
	padding-bottom: 8px;
	
	width: 50%;
}

div#outputLayer {
	text-align: left;
}

canvas {
	width: 100%;
}
.container {
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.calculator {
  background-color: #06597a;
  width: 350px;
  height: 500px;
  border-radius: 10px;
  padding: 10px 20px;
  border: solid 6px #ffffff;
}
.calculator__display--for-advanced {
  background-color: #f09393;
  height: 100px;
  width: 100%;
  border-radius: 10px;
  font-size: 30px;
  text-align: center;
  vertical-align: middle;
  padding: 25px 15px;
  overflow: hidden;
  overflow-wrap: break-word;
}
.calculator__buttons {
  background-color: #ffffff;
  width: 100%;
  height: 330px;
  margin-top: 10px;
  padding: 10px;
  border-radius: 10px;
  font-size: 25px;
}
.clear__and__enter {
  text-align: center;
  height: 50px;
  margin: 10px;
  border-radius: 10px;
  background-color: #ffffff;
}
.clear__and__enter > button {
  border-radius: 10px;
  width: 125px;
  height: 50px;
  margin: 0px 0px;
  background-color: #f09393; 
  cursor: pointer;
  outline: none;
  border: 0px solid #30bb98;
}
.button__row {
  border-radius: 10px;
  text-align: center;
  height: 50px;
  margin: 10px;
  background-color: #ffffff;
}
.button__row > button {
  width: 60px;
  height: 50px;
  border-radius: 10px;
  cursor: pointer;
  outline: none;
  background-color: #bdb2b2;
}
.button__row > .operator {
  color: #ffffff;
  background-color: #313132;
}
.button__row > .double {
  width: 125px;
}
.button__row > .isPressed {
  background-color: #00da75;
}

</style>

<script type="text/javascript">
const calculator = document.querySelector('.calculator'); // calculator ì—˜ë¦¬ë¨¼íŠ¸ì™€, ê·¸ ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì •ë³´ë¥¼ ëª¨ë‘ ë‹´ê³  ìˆìŒ.
const buttons = calculator.querySelector('.calculator__buttons'); // calculator__keys ì—˜ë¦¬ë¨¼íŠ¸ì™€, ê·¸ ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì •ë³´ë¥¼ ëª¨ë‘ ë‹´ê³  ìˆìŒ.
const operator = document.querySelector('.calculator__operator'); // calculator__operator ì—˜ë¦¬ë¨¼íŠ¸ì™€, ê·¸ ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì •ë³´ë¥¼ ëª¨ë‘ ë‹´ê³  ìˆìŒ.
const display = document.querySelector('.calculator__display--for-advanced'); // calculator__display ì—˜ë¦¬ë¨¼íŠ¸ì™€, ê·¸ ìì‹ ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì •ë³´ë¥¼ ëª¨ë‘ ë‹´ê³  ìˆìŒ.

let firstNum = '';
let operatorForAdvanced = '';
let previousKey = '';
let previousNum = '';


function calculate(n1, operator, n2) {
	  let result = 0;
	  if(operator === '+') {
	    result = Number(n1) + Number(n2); // '+'ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
	  }
	  else if(operator === '-') {
	     result = Number(n1) - Number(n2); // '-'ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
	  }
	  else if(operator === '*') {
	     result = Number(n1) * Number(n2); // '*'ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
	  }
	  if(operator === '/') {
	     result = Number(n1) / Number(n2); // '/'ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
	  }
	  return String(result);
	}
	

buttons.addEventListener('click', function (event) {
	  const target = event.target; // í´ë¦­ëœ HTML ì—˜ë¦¬ë¨¼íŠ¸ì˜ ì •ë³´ê°€ ì €ì¥ë˜ì–´ ìˆìŒ.
	  const action = target.classList[0]; // í´ë¦­ëœ HTML ì—˜ë¦¬ë¨¼íŠ¸ì— í´ë ˆìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì˜´.
	  const buttonContent = target.textContent; // í´ë¦­ëœ HTML ì—˜ë¦¬ë¨¼íŠ¸ì˜ í…ìŠ¤íŠ¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜´.

	  if (target.matches('button')) {
	    if (action === 'number') { //í´ë¦­ëœ HTML ì—˜ë¦¬ë¨¼íŠ¸ì˜ í´ë˜ìŠ¤ ë„¤ì„ì´ 'number'ë¼ë©´
	      if (display.textContent === '0' && operatorForAdvanced === '') {
	        display.textContent = buttonContent;
	        firstNum = display.textContent // ì²«ë²ˆì§¸ ìˆ«ìë¥¼ ë³€ìˆ˜ì— í• ë‹¹
	      } // ê¸°ì¡´ ê³„ì‚°ê¸° ìˆ«ìê°€ 0ì´ê³ , ì˜¤í¼ë ˆì´í„° ë²„íŠ¼ì´ ì•ˆëˆŒë¦° ìƒíƒœì˜ ë¶„ê¸°
	      else if (display.textContent !== '0' && operatorForAdvanced === ''){
	        display.textContent = display.textContent + buttonContent;
	       // textContentëŠ” ë¬¸ìì—´ì´ê¸° ë•Œë¬¸ì— ê¸°ì¡´ ê³„ì‚°ê¸°ì—ì„œ ë³´ì—¬ì§€ëŠ” ìˆ«ìì— +ì—°ì‚°ìë¡œ êµ¬í˜„ 
	        firstNum = display.textContent ;
	      } // ê¸°ì¡´ ê³„ì‚°ê¸° ìˆ«ìê°€ 0ì´ ì•„ë‹ˆê³ , ì˜¤í¼ë ˆì´í„° ë²„íŠ¼ì´ ì•ˆëˆŒë¦° ìƒíƒœì˜ ë¶„ê¸°
	        // ex) 15ë¥¼ ëˆ„ë¥´ê¸° ìœ„í•´ 1ì„ ëˆ„ë¥¸ ìƒíƒœì˜ ë¶„ê¸°(ë‘ìë¦¬ ì—°ì† ëˆ„ë¥´ê¸° ìœ„í•œ ì½”ë“œ)
	      else if (display.textContent !== '0' && operatorForAdvanced !== '') {
	        if(previousKey === operatorForAdvanced) {
	          display.textContent = buttonContent;
	          previousKey = display.textContent; 
	          // ì§ì „í‚¤ë¥¼ ë³€ìˆ˜ì— í• ë‹¹ (ì§ì „í‚¤ê°€ ì˜¤í¼ë ˆì´í„°ëƒ ìˆ«ìëƒì— ë”°ë¼ ê³„ì‚°ê¸°ì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•¨)
	          previousNum = display.textContent; // ì§ì „ ìˆ«ìë¥¼ ë³€ìˆ˜ì— í• ë‹¹
	        } // ê¸°ì¡´ ê³„ì‚°ê¸° ìˆ«ìê°€ 0ì´ ì•„ë‹ˆê³ , ì˜¤í¼ë ˆì´í„° ë²„íŠ¼ì´ ëˆŒë¦° ìƒíƒœì˜ ë¶„ê¸°
	          // ex) 15+7ì„ í•˜ê¸° ìœ„í•´ 15ì™€ +ë¥¼ ëˆ„ë¥¸ ìƒíƒœ(ë‘ë²ˆì§¸ ìˆ«ìë¥¼ ëˆ„ë¥´ê¸° ìœ„í•œ ì½”ë“œ)
	        else if(previousKey !== operatorForAdvanced) {
	          display.textContent = display.textContent + buttonContent;
	          previousNum = display.textContent;
	        } // ex) 15+17ì„ í•˜ê¸° ìœ„í•´ 15ì™€ +, 1ì„ ëˆ„ë¥¸ ìƒíƒœ(17ì„ ì™„ì„±í•˜ê¸° ìœ„í•œ ì½”ë“œ)
	      }    
	    }
	    
	    if (action === 'operator') { // //í´ë¦­ëœ HTML ì—˜ë¦¬ë¨¼íŠ¸ì˜ í´ë˜ìŠ¤ ë„¤ì„ì´ 'operator'ì¼ë•Œ ë¶„ê¸°
	      operatorForAdvanced = buttonContent; // ì˜¤í¼ë ˆì´í„° ëˆ„ë¥¼ ë•Œ ëˆ„ë¥¸ í…ìŠ¤íŠ¸ ì •ë³´ í• ë‹¹
	      previousKey = operatorForAdvanced; // ì§ì „í‚¤ì— ì˜¤í¼ë ˆì´í„° í…ìŠ¤íŠ¸ ì •ë³´ í• ë‹¹
	    }

	    if (action === 'clear') { // AC(ì´ˆê¸°í™”) ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ ë¶„ê¸°
	      display.textContent = '0';
	      firstNum = '';
	      previousNum = '';
	      operatorForAdvanced = '';
	      previousKey = '';
	    }

	    if (action === 'calculate') { // Enter(ê³„ì‚°) ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œ
	      if(firstNum !== '' && operatorForAdvanced === '') {
	        display.textContent = firstNum;
	      }
	      else if(firstNum !== '' && previousNum === '') {
	        display.textContent = calculate(display.textContent, operatorForAdvanced, display.textContent)
	      } // ê¸°ì¡´ì— ì‘ì„±í–ˆë˜ calculate í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ê³„ì‚° ìƒí™©ì— ë”°ë¥¸ ì „ë‹¬ì¸ìì™€ í•¨ê»˜ í˜¸ì¶œ
	      else if(previousKey === display.textContent){
	        display.textContent = calculate(firstNum, operatorForAdvanced, previousNum)
	        //   if(operatorForAdvanced === '+') {
	        //   display.textContent = String(Number(firstNum) + Number(previousNum));
	        // } else if(operatorForAdvanced === '-') {
	        //   display.textContent = String(Number(firstNum) - Number(previousNum));
	        // } else if(operatorForAdvanced === '*') {
	        //   display.textContent = String(Number(firstNum) * Number(previousNum));
	        // } else if(operatorForAdvanced === '/') {
	        //   display.textContent = String(Number(firstNum) / Number(previousNum));      
	        // } // ê¸°ì¡´ì— ì‘ì„±í–ˆë˜ í•˜ë“œì½”ë”©..!       
	       } 
	       else if(previousKey !== display.textContent && previousNum !== '') {
	        display.textContent = calculate(display.textContent, operatorForAdvanced, previousNum)
	       }   
	       else if(previousKey !== display.textContent && previousNum === '') {
	        display.textContent = firstNum;
	       }
	     }
	   }
	});

</script>

</head>

<body>

	<main>
		<div style="float: right;">
			<h4>ìŠ¤ìº”</h4>
			<div id="frame" style="text-align: center;">
				<div id="loadingMessage">
					ğŸ¥ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br />ì›¹ìº ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤
				</div>
				<canvas id="canvas"></canvas>
			</div>
		</div>
	</main>
		<div>&nbsp;</div>
		<div id="test">
			<h1>QR ì½”ë“œ ë¦¬ë”</h1>
			<div id="output">
				<div id="outputMessage">QRì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë…¸ì¶œì‹œì¼œ ì£¼ì„¸ìš”</div>
				<div id="outputLayer">
					<span id="outputData"></span>
				</div>
			</div>
		</div>
		
		 <div class="container">
      <div class="calculator">
        <div class="calculator__display--for-advanced">0</div>
        <div class="calculator__buttons">
          <div class="clear__and__enter">
            <button class="clear">AC</button>
            <button class="calculate">Enter</button>
          </div>
          <div class="button__row">
            <button class="number">7</button>
            <button class="number">8</button>
            <button class="number">9</button>
            <button class="operator">+</button>
          </div>
          <div class="button__row">
            <button class="number">4</button>
            <button class="number">5</button>
            <button class="number">6</button>
            <button class="operator">-</button>
          </div>
          <div class="button__row">
            <button class="number">1</button>
            <button class="number">2</button>
            <button class="number">3</button>
            <button class="operator">*</button>
          </div>
          <div class="button__row">
            <button class="number double">0</button>
            <button class="decimal">.</button>
            <button class="operator">/</button>
          </div>
        </div>
      </div>
    </div>
		
		
		
</body>
</html>
<script type="text/javascript">
	document.addEventListener("DOMContentLoaded", function() {

		var video = document.createElement("video");
		var canvasElement = document.getElementById("canvas");
		var canvas = canvasElement.getContext("2d");
		var loadingMessage = document.getElementById("loadingMessage");
		var outputContainer = document.getElementById("output");
		var outputMessage = document.getElementById("outputMessage");
		var outputData = document.getElementById("outputData");

		function drawLine(begin, end, color) {

			canvas.beginPath();
			canvas.moveTo(begin.x, begin.y);
			canvas.lineTo(end.x, end.y);
			canvas.lineWidth = 4;
			canvas.strokeStyle = color;
			canvas.stroke();

		}

		// ì¹´ë©”ë¼ ì‚¬ìš©ì‹œ

		navigator.mediaDevices.getUserMedia({
			video : {
				facingMode : "environment"
			}
		}).then(function(stream) {
			video.srcObject = stream;
			video.setAttribute("playsinline", true); // iOS ì‚¬ìš©ì‹œ ì „ì²´ í™”ë©´ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒì„ ì „ë‹¬
			video.play();
			requestAnimationFrame(tick);

		});

		function tick() {

			loadingMessage.innerText = "âŒ› ìŠ¤ìº” ê¸°ëŠ¥ì„ í™œì„±í™” ì¤‘ì…ë‹ˆë‹¤."

			if (video.readyState === video.HAVE_ENOUGH_DATA) {

				loadingMessage.hidden = true;
				canvasElement.hidden = false;
				outputContainer.hidden = false;

				// ì½ì–´ë“¤ì´ëŠ” ë¹„ë””ì˜¤ í™”ë©´ì˜ í¬ê¸°

				canvasElement.height = video.videoHeight;
				canvasElement.width = video.videoWidth;

				canvas.drawImage(video, 0, 0, canvasElement.width,canvasElement.height);
				var imageData = canvas.getImageData(0, 0, canvasElement.width,canvasElement.height);
				var code = jsQR(imageData.data, imageData.width,imageData.height, {

							inversionAttempts : "dontInvert",

						});

				// QRì½”ë“œ ì¸ì‹ì— ì„±ê³µí•œ ê²½ìš°

				if (code) {

					// ì¸ì‹í•œ QRì½”ë“œì˜ ì˜ì—­ì„ ê°ì‹¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í…Œë‘ë¦¬ ìƒì„±

					drawLine(code.location.topLeftCorner,
							code.location.topRightCorner, "#FF0000");

					drawLine(code.location.topRightCorner,
							code.location.bottomRightCorner, "#FF0000");

					drawLine(code.location.bottomRightCorner,
							code.location.bottomLeftCorner, "#FF0000");
					drawLine(code.location.bottomLeftCorner,
							code.location.topLeftCorner, "#FF0000");

					outputMessage.hidden = true;
					outputData.parentElement.hidden = false;

					// QRì½”ë“œ ë©”ì‹œì§€ ì¶œë ¥

					outputData.innerHTML = code.data;

					// returnì„ ì¨ì„œ í•¨ìˆ˜ë¥¼ ë¹ ì ¸ë‚˜ê°€ë©´ QRì½”ë“œ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œëœë‹¤.
					// return;

				}

				// QRì½”ë“œ ì¸ì‹ì— ì‹¤íŒ¨í•œ ê²½ìš° 

				else {

					outputMessage.hidden = false;

					outputData.parentElement.hidden = true;
				}
			}
			requestAnimationFrame(tick);
		}
	});
</script>


